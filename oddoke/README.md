# 5/19~5/23 어덕해 개발 일기
## 아티스트 자료 수집 및 모델링
- 포카마켓에서 트로트 가수, 야구팀 제외하고 아티스트 수집
- 멜론에 검색해서 display_name이 영어인지 한글인지 확인 => 영어명, 한글명 모두 수집, 줄임말 있는 경우 기재함
- 멤버 정보는 네이버에 검색해서 수집, 이 과정에서 해체한 팀 있는지 검색해서 확인, 해체한 그룹의 경우 목록에서 제외
- 트위터 프로필 이미지에서 로고 사진 수집, 트위터 프로필이 로고가 아닌 경우 구글에 검색해서 수집
- 아티스트 목록 csv 파일 => 모든 가수를 한글 오름차순으로 정렬해서 id값 부여
- 아티스트 모델링 => display_name, english_name, korean_name, alias 필드 부여
- Django-import-export 라이브러리 사용하여 아티스트 데이터 밀어 넣기
- 아티스트 목록 csv 파일에 logo 칼럼 추가하여 이미지 경로 작성
- 처음에는 로컬에서 불러오려고 했는데 자꾸 오류가 나서 강사님께 도움을 요청했더니 static/image/ 폴더 안에 이미지를 넣고 그 경로를 불러오는 게 좋다는 답변을 받음
- 경로 전부 수정...
- 했더니 문제 해결 완료!
- 아티스트 목록 불러오기 성공! 아티스트 로고가 전부 보이는 화면을 스크롤하는데 너무 뿌듯했다

## 모델링 변경
- 앱 구성을 “유저 / 아티스트 / 덕팜 / 덕담 / 덕생”으로 나누기로 하고 글 쓰는 post 모델을 덕팜에서 하나, 덕생에서 하나 생성했는데 막상 만들어보니 게시판에서 카테고리에 따라 작성해야하는 필드가 다르다보니 null값이 많이 생성됨
- 덕팜(거래/대여/분철), 덕담(커뮤니티/예절샷/생카후기)로 모델 분리하기로 결정
- SQLD 공부하다보니 이게 정규화인 것 같다...
- 일단 공통으로 들어가는 필드(제목, 내용, 이미지 등)를 받을 베이스 포스트 모델을 만들고 나머지 포스트 모델에서 베이스 모델을 상속함
- 모델이 분리 됐으므로 forms.py/urls.py/views.py/html template 전부 수정 작업에 들어갔다......... 이 과정 중에 기존에 예쁘게 꾸며뒀던 것들 전부 날아가서 눈물 났음ㅜ 물론 하나하나 고쳐야될 거 찾아서 수정하느라 눈도 빠질 것 같았음....
- 모델마다 crud 로직을 전부 분리하자니 중복되는 코드가 너무 많아서 카테고리를 불러주는 함수들을 utils.py에 생성하고 views.py에서는 한번에 처리하도록 코드를 작성
- 이 부분은 거의 gpt가 하라는 대로 해서 코드 보면서 어떻게 짠건지 확인해봐야함...
- 덕담 먼저 만들고 덕팜 만들었는데 덕함은 필드가 더 많았고...
- 거래 글이랑 대여 글은 구성이 거의 비슷한데 분철팟만 혼자 너무 달라서 상속을 두번 하도록 모델을 구성함 => 코드 중복 많이 줄여서 혼자 속으로 뿌듯했다
- BasePost -> MarketPost -> SellPost, RentalPost
- BasePost -> SplitPost
- 나머지는 덕담에서 만들어둔 거 그대로 따라하면서 모델명만 맞게 수정함
- 이틀에 걸쳐서 모델 분리 완료!
- 근데 이제 이미지를 여러개 업로드하는 기능을 넣으려고 했더니 포스트 모델이 6개인 게 또 문제가 됨.......... 이거 어케하묘

# 5/25~5/31 어덕해 개발 일기
## 최애 멤버 선택 기능
- 아티스트 인덱스에서 최애 아티스트 선택 => 마이페이지에서 최애 멤버 선택
- 그룹 로고 클릭 시 멤버 목록 모달창 생성
- 여기서 nct 때문에 문제가 발생하는데...
- nct127 소속 멤버가 nct dream에도 소속되어있어서 nct127의 마크라는 멤버를 팔로우 했을 때 nct dream의 마크도 같은 사람이지만 다른 사람으로 인식되고 있었다. nct127 마크와 nct dream 마크가 다른 id값을 가지고 있었기 때문인데 csv 파일을 수정하여 같은 사람으로 인식되게 수정 => nct127의 마크를 팔로우하면 nct dream 목록을 볼 때 이미 팔로우중인 걸로 나오게 했다.

- 수정 전

| artist | member |
| --- | --- |
| nct | 마크 |
| nct dream | 마크 |
| nct 127 | 마크 |
- 마크는 한명인데 아이디값이 세개

- 수정 후
| artist | member |
| --- | --- |
| "nct, nct dream, nct 127" | 마크 |
- 같은 아이디 값을 가지도록 수정

## 리팩토링
- 아티스트와 포스트 모델을 연결하는 작업을 하다보니 덕팜의 create.html과 edit.html, 덕담의 create.html과 edit.html 규격이 모두 비슷한데 수정을 4번 해야하는 과정이 너무 불편하게 느껴졌다. => 유지보수성과 확장성을 위해서 리팩토링 하기로 결정
- include 방식과 extends 방식 (장단점 비교)

|  | `extends` | `include` |
| --- | --- | --- |
| 목적 | 상속(공통 레이아웃) | 재사용(반복 요소) |
| 사용 방식 | 부모-자식 구조 (블록으로 채워넣음) | 특정 위치에 그대로 삽입 |
| 예시 용도 | base.html → home.html, detail.html 등 | _header.html, _navbar.html, footer.html 등 |
| 코드 중복 관리 | 계층적 관리 / 전체적인 통일성 유지 | 독립된 일부 요소의 재사용 |

- include 방식을 사용하면서 공통된 요소를 빼고, 다른 부분은 if문으로 분기 처리
- 코드 비교하면서 끼워넣느라 눈알 빠질 것 같았는데 다 하고 났을 때 엄청 뿌듯했다..

# 6/2~6/7 어덕해 개발 일기
## 이미지 여러장 업로드
- 앞서 언급했듯이 post 모델이 앱마다 3개(총 6개)라서 다중 이미지 모델과 포스트 모델을 연결할 때 어떤 foriegn key를 사용해야할지 고민이 되었다... 
1. 각 모델에 foriegn key로 하나씩 연결해서 모델 총 6개 만들기
2. 이미지 모델 한개에 포스트 모델 3개를 foriegn key로 연결해서 null값 허용
3. generic foreign key 사용
- 1번의 번거로움과 2번의 null값이 신경쓰였기 때문에 3번으로 결정
- 쿼리문 작성할 때 복잡하다는 단점이 있었는데... 일단은 구현할 때 덜 피로한 쪽으로 결정함
- 각 모델마다 연결 이름을 설정해주면 불러오기도 어렵지 않았다
- 이미지 모델과 연결하고 나서 이미지 업로드를 조금 더 편하게 구현할 수 있도록 하는 기타 기능(대표 이미지 설정, 이미지 삭제, 이미지 순서 설정 등)까지 구현

## 분철 모델링
- 자바 스크립트는 너무 어렵다...
- 분철에서 제일 중요한 기능은 아티스트를 선택했을 때 아티스의 멤버 목록이 불러와지고 멤버별로 가격 설정을 할 수 있어야한다는 것... 당연히 뷰 함수와 html 템플릿으로는 구현이 힘들고 자바 스크립트 사용이 필수적이었다.... 근데 자바 스크립트가 내 말을 안 들어,,,,,,,

# 6/9~6/14 어덕해 개발 일기
## 알림
- 웹 서비스이기는 하지만 사용자끼리의 소통이 중요한 만큼 알림 기능을 구현하면 좋을 것 같아서 구현함
- 게시글에 댓글 달렸을 때, 댓글에 답글이 달렸을 때, 분철 요청이 들어왔을 때, 분철 요청이 승인/거절 되었을 때, 채팅이 왔을 때, 게시글에 좋아요가 눌렸을 때, 팔로우 유저가 생겼을 때 알림을 받아볼 수 있다
- 장고 시그널을 사용해서 구현
- 실시간 알림은 아니지만 3분마다 서버에 폴링 방식으로 요청을 보내서 알림을 줌 => 서버에 어느정도 부하를 줄 것으로 예상은 되지만.. 나중에 고치기로
- 분철 승인과 마찬가지로 생일 카페 업로드가 승인 되었을 때, 공식 팬덤 인증이 승인되었을 때도 알림이 오면 좋을 것 같아서 구현하려고 시도 => 잘 안 됨
- 관리자 페이지에서 승인이 이루어졌을 때 알림을 생성하는 것이 더 쉽다고 해서 다음주 목표는 관리자 페이지 만들기로...

## 유저 모델 분리
- 기존 유저 모델에 팬덤 인증과 계좌 정보가 합쳐져 있어서 db에 null값이 많이 생김 => 수정하기로 함
- 기존 유저 프로필 + 팬덤 프로필 + 계좌 프로필 + 주소 프로필로 나누어서 모델 생성
- 팬덤, 계좌, 주소 프로필은 지연 생성 방식으로 유저가 원할 때 추가할 수 있도록 구현현

## 배포
- 6/12 어덕해 1차 배포..!
- 도메인도 사서 붙여보니 진짜 사이트 같아서 넘 신기했당
- 배포하고 나니 모바일 버전 대응을 더 잘 해야할 것 같다는 생각이 들었고... 이전에는 몰랐던 오류들도 발견하게 됨 => 다음주에 차차 고쳐야지...
- https 연결을 안했더니 채팅은 아예 동작을 안해서.. 다음주에 https 붙이고 다시 테스트해보기로 했다

# 6/16~6/21 어덕해 개발 일기
## 다중 가격
- 아이돌 굿즈 중고 거래 특성상 한번에 여러가지 물품을 찍어서 올릴 수 있기 때문에 가격 필드를 여러개 생성할 수 있도록 구현
- 기존 price 필드를 itemprice 모델로 변경하는 작업 필요

## 채팅 모델 수정
- 기존에 송신자, 수신자 명명이 제대로 되어있지 않아서 코드 가독성이 떨어지는 문제 해결

## 분철 채팅 그룹화
- 총대의 경우 한개의 분철 글에 여러개의 채팅이 따라오기 때문에 분철 채팅을 그룹화하여 관리가 편하도록 구현함

## 채팅 이미지 자세히 보기
- 사진을 받았을 때 하자 등의 확인을 위해 이미지 자세히 보기 + 확대 기능 구현
- 이미지 메타 정보를 받아서 언제 찍은 사진인지 표시할 수 있도록 함 => 제대로 구현 되는지 확인 필요

## 채팅방 ui 업데이트
- 채팅방 내부에서 게시글로 이동하면 좋을 것 같아서 헤더  ui 변경 / 대신 채팅 목록에서는 뺌

## 계좌 사기 조회 업데이트
- 계좌 등록을 하지 않고 그냥 이용하는 이용자들을 대비하여 계좌 사기 조회 모달창 새로 만듦
- 10-16자리의 숫자가 채팅방에 나타날 경우 자동으로 인식하여 계좌에 대한 사기 조회를 할 수 있도록 유도

# 6/23~6/28
## naming
- account의 mypage 기능에서 자기만 볼 수 있는 설정 페이지들 url 이름을 모두 username에서 my로 변경 => 어차피 본인만 볼 수 있는 페이지이기 때문에 링크가 더 깔끔해짐
- account의 계좌 모델 이름이 bankprofile인데 내부 필드 이름은 account_number로 되어있어서 accounts라는 앱 네임과 헷갈리는 문제 => bank_로 수정하여 통일성 유지

## user 모델
- user 모델의 social_signup 여부와 신고 여부를 onetoone 필드로 분리

## redis 연결
- 채팅방 실시간 대화의 경우 알림이 오지 않는 것이 자연스러운 흐름인데, db에 데이터를 넣고 그것을 읽는 현재 구조상, 구현하기가 어려움 => redis를 사용하여 실시간 알림 개선 시도
- 이전의 경우 실시간 채팅을 했을 때 알림 목록에 메시지가 올 때마다 알림이 쌓이는 문제가 있었는데 redis 연결 후 대화를 묶어서 처리해서 알림 폭탄 문제는 어느정도 해결함
- 하지만 여전히 실시간 대화를 할 때 알림이 온다는 것은 자연스럽지 않은 흐름이므로 나중에 채팅 서비스를 redis와 연결하여 개선 시도할 예정